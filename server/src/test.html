<!DOCTYPE html>
<html lang="en" dir="ltr">
	<head>
		<meta charset="utf-8">
		<title>Socket test</title>
	</head>
	<body>
		Hey
		<script src="/socket.io/socket.io.js"></script>
		<script>
			const socketIO = io.connect('http://localhost:8080');
			let room;

			async function newRoom(id = 0) {
				const fakeData = { mode: 'test', roomId: `aasdsa${id}`, hasPwd: true, pwd: 'secret', roomName: 'test room2', maxPlayers: 3 };
				await socketIO.emit('roomCreation', fakeData, (callback) => {
					console.log(callback);
				});
				room = fakeData.roomId;
			};

			async function getRoomList() {
				await socketIO.emit('getRoomList', { }, (callback) => console.log(callback));
			};

			async function roomInfos(id = room) {
				await socketIO.emit('roomInfos', { roomId: id }, (callback) => console.log(callback));
			}

			async function startGame(id = 0) {
				await socketIO.emit('startGame', { id }, (callback) => {
					console.log(callback);
				});
			};

			async function getNextPiece(id = room) {
				await socketIO.emit('gameNewTile', { roomId: id }, (callback) => {
					console.log('Receiving next piece: ');
					console.log(callback);
				});
			}

			async function joinRoom(id, pwd = 'secret') {
				await socketIO.emit('joinRoom', { roomId: id, pwd: pwd }, (callback) => console.log(callback));
			}

			async function getRoomInfo(id = room) {
				await socketIO.emit('getRoomInfo', { roomId: id }, (callback) => console.log(callback));
			}

			//
			async function scorePoint(id = room, row = 1) {
				await socketIO.emit('gameScored', { roomId: id, numberOfRows: row }, callback => console.log(callback));
			}
			socketIO.on('gameScored', (data) => console.log(`Player scored on room: ${data.roomId} with a score ${data.score}`));
			//
			async function setReady(id = room) {
				await socketIO.emit('playerReady', { roomId: id }, callback => console.log(callback));
			}

			// Game end !
			async function endGame(id = room) {
				await socketIO.emit('finishGame', { roomId: id }, callback => console.log(callback));
			}
			socketIO.on('gameOver', (data) => {
				console.log('End of game socket : ');
				console.log(data);
			});
			// /
			socketIO.on('roomCreated', (data) => {
				console.log(`NOTIFY: new room created: ${data.roomName}`);
			});

			socketIO.on('playerLeftGame', data => console.log(`NOTIFY: player of your room left: ${data.username}`));
			socketIO.on('playerEntersGame', data => console.log(`NOTIFY: player entered lobby: ${data.username}`));
			// /
			socketIO.on('gameHasStarted', (data) => {
				console.log('Game begins on lobby: ');
				console.log(data);
			});
		</script>
	</body>
</html>
